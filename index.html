<script>
  // ===== YouTube 최신 영상 불러오기 (프록시 사용) =====
  const PROXY_BASE = "/api"; // Netlify: "/api" / CloudflareWorkers: "https://<worker>.workers.dev"
  const CHANNEL_ID = "UCxxxxxxxxxxxxxxxx"; // @choshaaaa 채널의 실제 ID

  async function loadLatestYouTubeViaProxy() {
    const iframe = document.getElementById('ytPlayer');
    try {
      const res = await fetch(`${PROXY_BASE}/youtube-latest?channelId=${encodeURIComponent(CHANNEL_ID)}&maxResults=1`);
      const data = await res.json();
      const item = (data.items || [])[0];
      if (!item?.embedUrl) throw new Error("no video");
      iframe.src = item.embedUrl; // 최신 영상 삽입
      // (선택) 썸네일/제목 등을 화면에 더 노출하려면 item.title, item.thumbnail 사용
    } catch (e) {
      iframe.outerHTML = '<div class="muted" style="padding:16px;border:1px dashed var(--line);border-radius:12px;text-align:center">최신 영상을 불러오지 못했습니다. 아래 버튼으로 채널에서 확인하세요.</div>';
      console.warn(e);
    }
  }

  // ===== 네이버 블로그 최신 글 (프록시 RSS → 클라이언트에서 XML 파싱) =====
  async function loadNaverBlogLatestFromProxy(maxItems = 4) {
    const list = document.getElementById('blogList');
    try {
      const res = await fetch(`${PROXY_BASE}/naver-rss?id=mktstory`);
      const xmlText = await res.text();
      const doc = new DOMParser().parseFromString(xmlText, "application/xml");
      const items = [...doc.querySelectorAll("item")].slice(0, maxItems);
      list.innerHTML = items.map(it => {
        const title = it.querySelector("title")?.textContent?.trim() || "제목 없음";
        const link  = it.querySelector("link")?.textContent?.trim() || "#";
        const date  = it.querySelector("pubDate")?.textContent || "";
        const dstr  = date ? new Date(date).toLocaleDateString() : "";
        return `<a class="post" href="${link}" target="_blank" rel="noreferrer">
                  <strong>${title}</strong><br>
                  <span class="muted" style="font-size:13px">${dstr}</span>
                </a>`;
      }).join("");
    } catch (e) {
      list.innerHTML = '<div class="muted">최신 글을 불러오지 못했습니다. 상단 버튼으로 이동해 확인해주세요.</div>';
      console.warn(e);
    }
  }

  loadLatestYouTubeViaProxy();
  loadNaverBlogLatestFromProxy(4);
</script>
